<div class="mt-6 px-2 sm:px-3 md:px-4">
  <div class="mb-4 flex flex-wrap items-center justify-between gap-3">
    <div class="flex items-center gap-3">
      <span class="inline-flex h-9 w-9 items-center justify-center rounded-xl bg-teal-600/10 text-teal-700">
        <i class="fas fa-table"></i>
      </span>
      <div>
        <h2 class="text-xl sm:text-2xl font-bold text-slate-800">Vista de tabla</h2>
        <p class="text-[12px] text-slate-500">{{ filtrarDatos().length }} tareas · ordenadas por última edición</p>
      </div>
    </div>

    <div class="hidden sm:flex items-center gap-4 rounded-lg bg-slate-50 px-3 py-2 ring-1 ring-slate-200">
      <span class="inline-flex items-center gap-2 text-xs text-slate-600">
        <span class="h-2.5 w-2.5 rounded-full bg-sky-500"></span> Todo
      </span>
      <span class="inline-flex items-center gap-2 text-xs text-slate-600">
        <span class="h-2.5 w-2.5 rounded-full bg-amber-500"></span> En progreso
      </span>
      <span class="inline-flex items-center gap-2 text-xs text-slate-600">
        <span class="h-2.5 w-2.5 rounded-full bg-emerald-500"></span> Completado
      </span>
    </div>
  </div>

  <div class="bg-white rounded-2xl ring-1 ring-black/5 shadow-sm">
    <table class="w-full min-w-[680px] table-auto">
      <colgroup>
        <col class="w-12 sm:w-14" />
        <col class="w-[52%]" />
        <col class="w-[26%] sm:w-[24%]" />
        <col class="w-[18%]" />
      </colgroup>

      <thead class="bg-gradient-to-b from-slate-50 to-white border-b border-slate-200">
        <tr class="text-left text-slate-500 text-xs sm:text-[13px] uppercase tracking-wide">
          <th class="px-4 py-3 font-semibold">#</th>
          <th class="px-4 py-3 font-semibold">Tarea</th>
          <th class="px-4 py-3 font-semibold">Estado</th>
          <th class="px-4 py-3 font-semibold text-center">Acciones</th>
        </tr>
      </thead>

      <tbody class="[&>tr:nth-child(odd)]:bg-white [&>tr:nth-child(even)]:bg-slate-50">
        <ng-container *ngIf="filtrarOrdenado().length > 0; else emptyRows">
          <ng-container *ngFor="let task of filtrarOrdenado(); let i = index">
            <tr class="align-top hover:bg-teal-50/40 transition-colors">

              <td class="px-4 py-4 text-slate-500 tabular-nums">{{ i + 1 }}</td>

              <td class="px-4 py-3">
                <div class="flex items-start justify-between gap-3">
                  <div class="flex-1">
                    <p *ngIf="editingTaskId !== task.id; else editingField" class="text-slate-800 break-words"
                      [ngClass]="{ 'line-through text-slate-400' : isDone(task.status) }">{{ task.text }}</p>

                    <ng-template #editingField>
                      <input [(ngModel)]="inputValue" type="text" class="w-full rounded-lg border border-slate-300 px-3 py-2 text-slate-900
                         focus:outline-none focus:ring-2 focus:ring-teal-600 focus:border-teal-600" />
                    </ng-template>

                    <p class="mt-1 text-[11px] text-slate-500 flex items-center gap-1.5">
                      <i class="far fa-clock"></i>
                      Última edición: {{ task.updatedAt ? (task.updatedAt | date:'dd/MM/yyyy HH:mm') : task.createdDate }}
                    </p>
                  </div>

                  <div *ngIf="editingTaskId === task.id" class="flex items-center gap-1">
                    <button class="p-2 rounded-md hover:bg-slate-100 cursor-pointer" (click)="cancelar(task)" aria-label="Cancelar">
                      <i class="fas fa-times text-slate-500"></i></button>
                    <button class="p-2 rounded-md hover:bg-slate-100 cursor-pointer" (click)="editar(task)" aria-label="Guardar">
                      <i class="fas fa-check text-teal-600"></i></button>
                  </div>
                </div>
              </td>

              <td class="px-4 py-3">
                <div class="relative inline-block">
                  <button type="button" class="inline-flex w-40 sm:w-44 items-center justify-between gap-3 rounded-md border border-slate-300
                     px-3 py-1.5 text-sm text-slate-800 hover:bg-slate-50 cursor-pointer"
                    (click)="toggleStatusMenu(task.id, $event)">
                    <span class="inline-flex items-center gap-2">
                      <span class="h-2.5 w-2.5 rounded-full" [ngClass]="dotClassOf(task.status)"></span>
                      {{ labelOf(task.status) }}
                    </span>
                    <i class="fas fa-chevron-down text-slate-400 text-xs"></i>
                  </button>

                  <div *ngIf="openStatusForId === task.id" class="absolute right-0 z-20 mt-2 w-44 overflow-hidden rounded-xl border border-slate-200 bg-white
                     shadow-[0_10px_25px_-5px_rgb(0_0_0_/_0.1),0_8px_10px_-6px_rgb(0_0_0_/_0.1)]"
                    (click)="$event.stopPropagation()">
                    <button class="w-full flex items-center gap-2 px-3 py-2 text-sm hover:bg-slate-50"
                      (click)="updateStatus(task, 'todo')">
                      <span class="h-2.5 w-2.5 rounded-full bg-sky-500"></span> Todo
                    </button>
                    <button class="w-full flex items-center gap-2 px-3 py-2 text-sm hover:bg-slate-50"
                      (click)="updateStatus(task, 'in-progress')">
                      <span class="h-2.5 w-2.5 rounded-full bg-amber-500"></span> En progreso
                    </button>
                    <button class="w-full flex items-center gap-2 px-3 py-2 text-sm hover:bg-slate-50"
                      (click)="updateStatus(task, 'done')">
                      <span class="h-2.5 w-2.5 rounded-full bg-emerald-500"></span> Completado
                    </button>
                  </div>
                </div>
              </td>

              <td class="px-4 py-3 text-center">
                <div class="relative inline-block">
                  <button class="inline-flex h-9 w-9 items-center justify-center rounded-lg hover:bg-slate-100
                           text-slate-500 focus:outline-none focus-visible:ring-2 focus-visible:ring-teal-600"
                    (click)="toggleActionsMenu(task.id, $event)" aria-label="Abrir menú"><i class="fas fa-ellipsis-h"></i></button>

                  <div *ngIf="openActionsForId === task.id" class="absolute right-0 z-20 mt-2 w-40 overflow-hidden rounded-xl bg-white
                        shadow-[0_10px_25px_-5px_rgb(0_0_0_/_0.1),_0_8px_10px_-6px_rgb(0_0_0_/_0.1)]
                        ring-1 ring-black/5" (click)="$event.stopPropagation()">
                    <button class="w-full flex items-center gap-2 px-3 py-2 text-sm hover:bg-slate-50"
                      (click)="enableInput(task, i); closeMenus()">
                      <i class="far fa-edit text-slate-500"></i> <span>Editar</span>
                    </button>
                    <div class="h-px bg-slate-100"></div>
                    <button class="w-full flex items-center gap-2 px-3 py-2 text-sm text-red-600 hover:bg-red-50"
                      (click)="deleteTask(task)">
                      <i class="far fa-trash-alt"></i> <span>Eliminar</span>
                    </button>
                  </div>
                </div>
              </td>
            </tr>
          </ng-container>
        </ng-container>

        <ng-template #emptyRows>
          <tr>
            <td colspan="4" class="px-6 py-14">
              <div class="mx-auto max-w-md text-center">
                <div class="mx-auto mb-3 grid h-12 w-12 place-items-center rounded-2xl bg-slate-100 text-slate-500">
                  <i class="fas fa-inbox"></i>
                </div>
                <h3 class="text-slate-800 font-semibold">No hay tareas</h3>
                <p class="mt-1 text-sm text-slate-500">
                  Crea una tarea desde la vista Board o cambia el filtro.
                </p>
              </div>
            </td>
          </tr>
        </ng-template>
      </tbody>

    </table>
  </div>
</div>